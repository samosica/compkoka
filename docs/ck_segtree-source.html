<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="initial-scale=1.0" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Nunito:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>segtree.kk documentation</title>
</head>

<body class="koka doc body madoko">
<pre class="koka source"><span class="comment">/&#42; Segment tree

Usage:

&#96;&#96;&#96;
import ck/segtree

// 1. Define a monoid
fun mon(): monoid&lt;int&gt;
  Monoid(0, (+))

fun main()
  // 2. Create a segment tree
  val t = segtree(10, mon())

  // 3. Manipulate it (see below)
  t.set(1, 3)
  t.set(3, 8)
  t.product(0, 10).println // 11
&#96;&#96;&#96;
\/
&#42;/</span>
<span class="kw">module</span> segtree

<span class="decl-type" id="type_space_monoid"><span class="warning"><span class="popup"><span class="popup-content"><span class="kw">warning: </span>Type monoid may be better declared as a value type for efficiency (e.g. 'value type/struct'),
or declared as a reference type to suppress this warning (e.g. 'ref type/struct')</span><span class="kw">pub</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Monoid"><a class="pp" href="ck_segtree.html#type_space_monoid"><span class="tp">monoid</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>monoid: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <span class="decl-fun" id="one"><a class="pp">one<span class="pc">one: <span class="number">4</span></span></a></span> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>
  <span class="decl-fun" id="mul"><a class="pp">mul<span class="pc">mul: <span class="tp sp">(</span><span class="number">4</span>, <span class="number">4</span>) <span class="kw op">-></span> <span class="number">4</span></span></a></span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">,</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> </span></span></span></span><a class="pp" href="std_core_types-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">a</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;&gt;): <span class="co">E</span></span></a>

<span class="decl-type" id="type_space_segtree"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Segtree"><a class="pp" href="ck_segtree.html#type_space_segtree"><span class="tp">segtree</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>segtree: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <span class="decl-fun" id="prod"><a class="pp">prod<span class="pc">prod: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="number">13</span>,vector<span class="op">&lt;</span><span class="number">14</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_ref"><span class="tp">ref</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>ref: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_vector"><span class="tp">vector</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>vector: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span>
  <span class="decl-fun" id="leaf_count"><a class="pp">leaf-count<span class="pc">leaf<span class="dash">-</span>count: <span class="tp">int</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>
  <span class="decl-fun" id="mon"><a class="pp">mon<span class="pc">mon: <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="number">14</span><span class="op">&gt;</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="#type_space_monoid"><span class="tp">monoid</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>monoid: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a></span></span><span class="tp sp">&gt;</span>

<span class="comment">// Create a segment tree
</span><span class="decl-fun" id="segtree"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="ck_segtree.html#segtree">segtree<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>segtree: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">mon</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>, <a class="pp">mon<span class="pc">mon: <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">1679</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="#type_space_monoid"><span class="tp">monoid</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>monoid: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>)<span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_alloc"><span class="tp">alloc</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>alloc: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="#type_space_segtree"><span class="tp">segtree</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>segtree: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <a class="pp" href="std_core_hnd-source.html#local_var"><span class="kw">var</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>hnd<span class="fslash last">/</span></span>local<span class="dash">-</span>var: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">init</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">l</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span></span></a> <a class="pp" href="std_core_types-source.html#local_scope">leaf-count<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>local<span class="dash">-</span>scope: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a> <span class="kw op">:=</span> <span class="number">1</span>
  <a class="pp" href="std_core_types-source.html#unsafe_no_div">unsafe-no-div<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>no<span class="dash">-</span>div: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a> {
    <a class="pp" href="std_core-source.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> { <a class="pp">leaf-count<span class="pc">leaf<span class="dash">-</span>count: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_lt__1">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> } { <a class="pp">leaf-count<span class="pc">leaf<span class="dash">-</span>count: <span class="tp">local<span class="dash">-</span>var</span><span class="tp op">&lt;$</span><span class="number">1684</span>,int<span class="op">&gt;</span></span></a> <a class="pp" href="std_core_types-source.html#local_set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>local<span class="dash">-</span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">leaf-count<span class="pc">leaf<span class="dash">-</span>count: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span> }
  }
  <a class="pp" href="#con_space_Segtree"><span class="co">Segtree</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>Segtree: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">prod</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">leaf<span class="dash">-</span>count</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">mon</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(
    <a class="pp" href="std_core_types-source.html#ref">ref<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>ref: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#vector_2">vector<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>vector<span class="postfix">.2</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">leaf-count<span class="pc">leaf<span class="dash">-</span>count: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span>, <a class="pp">mon<span class="pc">mon: <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">1679</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#one">one<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>one: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>)),
    <a class="pp">leaf-count<span class="pc">leaf<span class="dash">-</span>count: <span class="tp">int</span></span></a>,
    <a class="pp">mon<span class="pc">mon: <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">1679</span><span class="op">&gt;</span></span></a>
  </span>)

<span class="comment">// Get the &#96;k&#96;-th element.
// The first element is at position 0 (0-based).
</span><span class="decl-fun" id="_index_"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="ck_segtree.html#_index_">[<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>([]): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">seg</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">k</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>](<span class="op">^</span><a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">316</span>,<span class="op">$</span><span class="number">315</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="#type_space_segtree"><span class="tp">segtree</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>segtree: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>, <span class="op">^</span><a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>)<span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;&gt;): <span class="co">E</span></span></a><a class="pp" href="std_core_types-source.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>read: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="co">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>
  (<a class="pp" href="std_core_types-source.html#_excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(!): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">316</span>,<span class="op">$</span><span class="number">315</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#prod">prod<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>prod: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>)<a class="pp" href="std_core-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>([]): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">316</span>,<span class="op">$</span><span class="number">315</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#leaf_count">leaf-count<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>leaf<span class="dash">-</span>count: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a></span>]

<span class="comment">// TODO: is div removable?
</span>inline <span class="decl-fun" id="recalc"><span class="kw">fun</span> <a class="pp" href="ck_segtree.html#recalc">recalc<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>recalc: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">seg</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">k</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1378</span>,<span class="op">$</span><span class="number">1377</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="#type_space_segtree"><span class="tp">segtree</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>segtree: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>)<span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;&gt;): <span class="co">E</span></span></a><a class="pp" href="std_core_types-source.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>read: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_write"><span class="tp">write</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>write: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="co">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core_types-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(): <span class="co">V</span></span></a><a class="pp" href="std_core_types-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(): <span class="co">V</span></span></a>
  <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1378</span>,<span class="op">$</span><span class="number">1377</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#prod">prod<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>prod: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core_types-source.html#modify">modify<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>modify: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a> <span class="kw">fn</span>(<a class="pp">prod<span class="pc">prod: <span class="tp">local<span class="dash">-</span>var</span><span class="tp op">&lt;$</span><span class="number">1390</span>,vector<span class="op">&lt;$</span><span class="number">1377</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a>)
    <span class="decl-fun" id="loop"><span class="kw">fun</span> <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">pure</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">1390</span><span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>)
      <span class="kw">if</span> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_lt__eq__1">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;=)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">1</span> <span class="kw">then</span> <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="std_core_types-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core_types-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
      <span class="kw">val</span> <a class="pp">p<span class="pc">p: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span>
      <a class="pp">prod<span class="pc">prod: <span class="tp">local<span class="dash">-</span>var</span><span class="tp op">&lt;$</span><span class="number">1390</span>,vector<span class="op">&lt;$</span><span class="number">1377</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a><a class="pp" href="std_core-source.html#_lb__rb__1">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>([])<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">self</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp">p<span class="pc">p: <span class="tp">int</span></span></a>] <span class="kw op">:=</span> (<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1378</span>,<span class="op">$</span><span class="number">1377</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mon">mon<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mon: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mul">mul<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mul: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>)(<a class="pp">prod<span class="pc">prod: <span class="tp">vector</span><span class="tp op">&lt;$</span><span class="number">1377</span><span class="op">&gt;</span></span></a><a class="pp" href="std_core-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>([]): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><a class="pp">p<span class="pc">p: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span>], <a class="pp">prod<span class="pc">prod: <span class="tp">vector</span><span class="tp op">&lt;$</span><span class="number">1377</span><span class="op">&gt;</span></span></a><a class="pp" href="std_core-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>([]): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><a class="pp">p<span class="pc">p: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>])
      <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">1390</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> ()</span></a>(<a class="pp" href="std_core_types-source.html#unsafe_decreasing">unsafe-decreasing<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>decreasing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<a class="pp">p<span class="pc">p: <span class="tp">int</span></span></a>)</span>)
    <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">pure</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">1390</span><span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a>(<a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a></span>)

<span class="comment">// Set a value to an element.
// The first element is at position 0 (0-based).
</span><span class="decl-fun" id="set"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="ck_segtree.html#set">set<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">seg</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">k</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1870</span>,<span class="op">$</span><span class="number">1869</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="#type_space_segtree"><span class="tp">segtree</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>segtree: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>, <a class="pp">v<span class="pc">v: <span class="tp op">$</span><span class="number">1869</span></span></a><span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>)<span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;&gt;): <span class="co">E</span></span></a><a class="pp" href="std_core_types-source.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>read: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_write"><span class="tp">write</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>write: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="co">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core_types-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(): <span class="co">V</span></span></a><a class="pp" href="std_core_types-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(): <span class="co">V</span></span></a>
  <span class="kw">val</span> <a class="pp">k'<span class="pc">k': <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1870</span>,<span class="op">$</span><span class="number">1869</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#leaf_count">leaf-count<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>leaf<span class="dash">-</span>count: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
  <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1870</span>,<span class="op">$</span><span class="number">1869</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#prod">prod<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>prod: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core_types-source.html#modify">modify<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>modify: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a> <span class="kw">fn</span>(<a class="pp">prod<span class="pc">prod: <span class="tp">local<span class="dash">-</span>var</span><span class="tp op">&lt;$</span><span class="number">1896</span>,vector<span class="op">&lt;$</span><span class="number">1869</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a>) { <a class="pp">prod<span class="pc">prod: <span class="tp">local<span class="dash">-</span>var</span><span class="tp op">&lt;$</span><span class="number">1896</span>,vector<span class="op">&lt;$</span><span class="number">1869</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a><a class="pp" href="std_core-source.html#_lb__rb__1">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>([])<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">self</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp">k'<span class="pc">k': <span class="tp">int</span></span></a>] <span class="kw op">:=</span> <a class="pp">v<span class="pc">v: <span class="tp op">$</span><span class="number">1869</span></span></a> }
  <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1870</span>,<span class="op">$</span><span class="number">1869</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#recalc">recalc<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>recalc: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">seg</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">k</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">k'<span class="pc">k': <span class="tp">int</span></span></a></span>)

<span class="comment">// Apply a function to an element.
// The first element is at position 0 (0-based).
</span><span class="decl-fun" id="update"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="ck_segtree.html#update">update<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>update: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">seg</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">k</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1975</span>,<span class="op">$</span><span class="number">1973</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="#type_space_segtree"><span class="tp">segtree</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>segtree: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>, <a class="pp">f<span class="pc">f: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp op">$</span><span class="number">1973</span>) <span class="kw op">-></span> <span class="op">&lt;</span>local<span class="op">&lt;</span>h<span class="op">&gt;</span>,div,exn<span class="op">|$</span><span class="number">1974</span><span class="op">&gt;</span> <span class="op">$</span><span class="number">1973</span></span></a><span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp">h1</span><span class="pc">h1: <span class="co">H</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core_types-source.html#type_space_local"><span class="tp">local</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>local: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h1</span><span class="pc">h1: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="co">HX</span></span></a><a class="pp" href="std_core_types-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="co">X</span>, <span class="co">E</span>) <span class="kw op">-></span> <span class="co">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="co">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>)<span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="std_core_types-source.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>read: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_write"><span class="tp">write</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>write: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="co">HX</span></span></a><a class="pp" href="std_core_types-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="co">X</span>, <span class="co">E</span>) <span class="kw op">-></span> <span class="co">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="co">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core_types-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(): <span class="co">V</span></span></a><a class="pp" href="std_core_types-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(): <span class="co">V</span></span></a>
  <span class="comment">// TODO: make the type of &#96;f&#96; simple
</span>  <span class="kw">val</span> <a class="pp">k'<span class="pc">k': <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1975</span>,<span class="op">$</span><span class="number">1973</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#leaf_count">leaf-count<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>leaf<span class="dash">-</span>count: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
  <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1975</span>,<span class="op">$</span><span class="number">1973</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#prod">prod<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>prod: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core_types-source.html#modify">modify<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>modify: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a> <span class="kw">fn</span>(<a class="pp">prod<span class="pc">prod: <span class="tp">local<span class="dash">-</span>var</span><span class="tp op">&lt;$</span><span class="number">2001</span>,vector<span class="op">&lt;$</span><span class="number">1973</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a>)
    <a class="pp">prod<span class="pc">prod: <span class="tp">local<span class="dash">-</span>var</span><span class="tp op">&lt;$</span><span class="number">2001</span>,vector<span class="op">&lt;$</span><span class="number">1973</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a><a class="pp" href="std_core-source.html#_lb__rb__1">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>([])<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">self</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp">k'<span class="pc">k': <span class="tp">int</span></span></a>] <span class="kw op">:=</span> <a class="pp">f<span class="pc">f: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp op">$</span><span class="number">1973</span>) <span class="kw op">-></span> <span class="op">&lt;</span>local<span class="op">&lt;</span>h<span class="op">&gt;</span>,div,exn<span class="op">|$</span><span class="number">1974</span><span class="op">&gt;</span> <span class="op">$</span><span class="number">1973</span></span></a>(<a class="pp">prod<span class="pc">prod: <span class="tp">vector</span><span class="tp op">&lt;$</span><span class="number">1973</span><span class="op">&gt;</span></span></a><a class="pp" href="std_core-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>([]): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><a class="pp">k'<span class="pc">k': <span class="tp">int</span></span></a>])
  <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">1975</span>,<span class="op">$</span><span class="number">1973</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#recalc">recalc<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>recalc: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">seg</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">k</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">k'<span class="pc">k': <span class="tp">int</span></span></a></span>)

<span class="comment">// Return the product from the &#96;left&#96;-th element (inclusive) to &#96;right&#96;-th element (exclusive).
// The first element is at position 0 (0-based).
</span><span class="decl-fun" id="product"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="ck_segtree.html#product">product<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>product: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">seg</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">833</span>,<span class="op">$</span><span class="number">832</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="#type_space_segtree"><span class="tp">segtree</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>segtree: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">left<span class="pc">left: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>, <a class="pp">right<span class="pc">right: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>)<span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;&gt;): <span class="co">E</span></span></a><a class="pp" href="std_core_types-source.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>read: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="co">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>
  <span class="decl-fun" id="loop"><span class="kw">fun</span> <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">l</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">r</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">pl</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">832</span>, pr <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">832</span>) <span class="kw op">-></span> <span class="op">&lt;</span>pure,read<span class="op">&lt;$</span><span class="number">833</span><span class="op">&gt;</span><span class="op">&gt;</span> <span class="op">$</span><span class="number">832</span></span></a>(<a class="pp">l<span class="pc">l: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>, <a class="pp">r<span class="pc">r: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>, <a class="pp">pl<span class="pc">pl: <span class="tp op">$</span><span class="number">832</span></span></a>, <a class="pp">pr<span class="pc">pr: <span class="tp op">$</span><span class="number">832</span></span></a>)
    <span class="kw">if</span> <a class="pp">l<span class="pc">l: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_lt__1">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">r<span class="pc">r: <span class="tp">int</span></span></a> <span class="kw">then</span>
      <span class="kw">val</span> <a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">l'<span class="pc">l': <span class="tp">int</span></span></a>, <a class="pp">pl'<span class="pc">pl': <span class="tp op">$</span><span class="number">832</span></span></a><a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span>
        <span class="kw">if</span> <a class="pp">l<span class="pc">l: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_perc_">%<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(%): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span> <a class="pp" href="std_core-source.html#_gt__1">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&gt;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">0</span> <span class="kw">then</span>
          <a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">l<span class="pc">l: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>, (<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">833</span>,<span class="op">$</span><span class="number">832</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mon">mon<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mon: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mul">mul<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mul: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>)(<a class="pp">pl<span class="pc">pl: <span class="tp op">$</span><span class="number">832</span></span></a>, (<a class="pp" href="std_core_types-source.html#_excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(!): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">833</span>,<span class="op">$</span><span class="number">832</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#prod">prod<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>prod: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>)<a class="pp" href="std_core-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>([]): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><a class="pp">l<span class="pc">l: <span class="tp">int</span></span></a>])<a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
        <span class="kw">else</span>
          <a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">l<span class="pc">l: <span class="tp">int</span></span></a>, <a class="pp">pl<span class="pc">pl: <span class="tp op">$</span><span class="number">832</span></span></a><a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
      <span class="kw">val</span> <a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">r'<span class="pc">r': <span class="tp">int</span></span></a>, <a class="pp">pr'<span class="pc">pr': <span class="tp op">$</span><span class="number">832</span></span></a><a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span>
        <span class="kw">if</span> <a class="pp">r<span class="pc">r: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_perc_">%<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(%): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span> <a class="pp" href="std_core-source.html#_gt__1">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&gt;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">0</span> <span class="kw">then</span>
          <a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_dash__4">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>, (<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">833</span>,<span class="op">$</span><span class="number">832</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mon">mon<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mon: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mul">mul<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mul: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>)((<a class="pp" href="std_core_types-source.html#_excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(!): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">833</span>,<span class="op">$</span><span class="number">832</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#prod">prod<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>prod: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>)<a class="pp" href="std_core-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>([]): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_dash__4">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>], <a class="pp">pr<span class="pc">pr: <span class="tp op">$</span><span class="number">832</span></span></a>)<a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
        <span class="kw">else</span>
          <a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">int</span></span></a>, <a class="pp">pr<span class="pc">pr: <span class="tp op">$</span><span class="number">832</span></span></a><a class="pp" href="std_core_types-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
      <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">l</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">r</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">pl</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">832</span>, pr <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">832</span>) <span class="kw op">-></span> <span class="op">&lt;</span>exn,read<span class="op">&lt;$</span><span class="number">833</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> <span class="op">$</span><span class="number">832</span></span></a>(<a class="pp">l'<span class="pc">l': <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span>, <a class="pp">r'<span class="pc">r': <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span>, <a class="pp">pl'<span class="pc">pl': <span class="tp op">$</span><span class="number">832</span></span></a>, <a class="pp">pr'<span class="pc">pr': <span class="tp op">$</span><span class="number">832</span></span></a>)
    <span class="kw">else</span>
      (<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">833</span>,<span class="op">$</span><span class="number">832</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mon">mon<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mon: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mul">mul<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mul: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>)(<a class="pp">pl<span class="pc">pl: <span class="tp op">$</span><span class="number">832</span></span></a>, <a class="pp">pr<span class="pc">pr: <span class="tp op">$</span><span class="number">832</span></span></a></span>)
  <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">l</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">r</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">pl</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">832</span>, pr <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">832</span>) <span class="kw op">-></span> <span class="op">&lt;</span>pure,read<span class="op">&lt;$</span><span class="number">833</span><span class="op">&gt;</span><span class="op">&gt;</span> <span class="op">$</span><span class="number">832</span></span></a>(
    <a class="pp">left<span class="pc">left: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">833</span>,<span class="op">$</span><span class="number">832</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#leaf_count">leaf-count<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>leaf<span class="dash">-</span>count: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>,
    <a class="pp">right<span class="pc">right: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">833</span>,<span class="op">$</span><span class="number">832</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#leaf_count">leaf-count<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>leaf<span class="dash">-</span>count: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>,
    <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">833</span>,<span class="op">$</span><span class="number">832</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mon">mon<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mon: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#one">one<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>one: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>,
    <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">833</span>,<span class="op">$</span><span class="number">832</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mon">mon<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mon: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#one">one<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>one: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>
  </span>)

<span class="comment">// Return the largest integer &#96;k&#96; such that the product from the first element
// (inclusive) to the &#96;k&#96;-th element (exclusive) holds &#96;p&#96;.
// The first element is at position 0 (0-based).
// &#96;p&#96; must be decreasing and the product of the empty interval must hold &#96;p&#96;.
</span><span class="decl-fun" id="binsearch"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="ck_segtree.html#binsearch">binsearch<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>binsearch: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">seg</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h1</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">int</span></span></a>(<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">503</span>,<span class="op">$</span><span class="number">501</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="#type_space_segtree"><span class="tp">segtree</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>segtree: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">p<span class="pc">p: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp op">$</span><span class="number">501</span>) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>h<span class="op">&gt;</span>,div,exn<span class="op">|$</span><span class="number">502</span><span class="op">&gt;</span> bool</span></a><span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp">h1</span><span class="pc">h1: <span class="co">H</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core_types-source.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>read: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h1</span><span class="pc">h1: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="co">HX</span></span></a><a class="pp" href="std_core_types-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="co">X</span>, <span class="co">E</span>) <span class="kw op">-></span> <span class="co">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="co">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core_types-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>bool: <span class="co">V</span></span></a>)<span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="std_core_types-source.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>read: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="co">HX</span></span></a><a class="pp" href="std_core_types-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="co">X</span>, <span class="co">E</span>) <span class="kw op">-></span> <span class="co">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="co">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>
  <span class="comment">// TODO: make the type of &#96;p&#96; simple
</span>  <span class="decl-fun" id="loop"><span class="kw">fun</span> <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp op">$</span><span class="number">501</span>, int) <span class="kw op">-></span> <span class="op">&lt;</span>pure,read<span class="op">&lt;$</span><span class="number">503</span><span class="op">&gt;|$</span><span class="number">502</span><span class="op">&gt;</span> int</span></a>(<a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a>, <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>, <a class="pp">v<span class="pc">v: <span class="tp op">$</span><span class="number">501</span></span></a>, <a class="pp">w<span class="pc">w: <span class="tp">int</span></span></a>)
    <span class="kw">if</span> <a class="pp">w<span class="pc">w: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">1</span> <span class="kw">then</span> <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp">int</span></span></a> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>
    <span class="kw">val</span> <a class="pp">v'<span class="pc">v': <span class="tp op">$</span><span class="number">501</span></span></a> <span class="kw">=</span> (<a class="pp" href="std_core_types-source.html#_excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(!): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp kw op">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">503</span>,<span class="op">$</span><span class="number">501</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#prod">prod<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>prod: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>)<a class="pp" href="std_core-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>([]): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span>]
    <span class="kw">if</span> <a class="pp">p<span class="pc">p: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp op">$</span><span class="number">501</span>) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;</span>h<span class="op">&gt;</span>,div,exn<span class="op">|$</span><span class="number">502</span><span class="op">&gt;</span> bool</span></a>((<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">503</span>,<span class="op">$</span><span class="number">501</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mon">mon<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mon: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mul">mul<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mul: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>)(<a class="pp">v<span class="pc">v: <span class="tp op">$</span><span class="number">501</span></span></a>, <a class="pp">v'<span class="pc">v': <span class="tp op">$</span><span class="number">501</span></span></a>)) <span class="kw">then</span>
      <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp op">$</span><span class="number">501</span>, int) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn,read<span class="op">&lt;$</span><span class="number">503</span><span class="op">&gt;|$</span><span class="number">502</span><span class="op">&gt;</span> int</span></a>(<a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span>, <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>, <a class="pp">v<span class="pc">v: <span class="tp op">$</span><span class="number">501</span></span></a>, <a class="pp">w<span class="pc">w: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span>)
    <span class="kw">else</span>
      <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp op">$</span><span class="number">501</span>, int) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn,read<span class="op">&lt;$</span><span class="number">503</span><span class="op">&gt;|$</span><span class="number">502</span><span class="op">&gt;</span> int</span></a>(<a class="pp">k<span class="pc">k: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_star_">&#42;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&#42;): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>, <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">w<span class="pc">w: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span>, (<a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">503</span>,<span class="op">$</span><span class="number">501</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mon">mon<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mon: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mul">mul<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mul: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>)(<a class="pp">v<span class="pc">v: <span class="tp op">$</span><span class="number">501</span></span></a>, <a class="pp">v'<span class="pc">v': <span class="tp op">$</span><span class="number">501</span></span></a>), <a class="pp">w<span class="pc">w: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_fs_">/<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="fslash">/</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">2</span></span>)
  <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp op">$</span><span class="number">501</span>, int) <span class="kw op">-></span> <span class="op">&lt;</span>pure,read<span class="op">&lt;$</span><span class="number">503</span><span class="op">&gt;|$</span><span class="number">502</span><span class="op">&gt;</span> int</span></a>(<span class="number">1</span>, <span class="number">0</span>, <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">503</span>,<span class="op">$</span><span class="number">501</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#mon">mon<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>mon: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#one">one<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>one: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>, <a class="pp">seg<span class="pc">seg: <span class="tp">segtree</span><span class="tp op">&lt;$</span><span class="number">503</span>,<span class="op">$</span><span class="number">501</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#leaf_count">leaf-count<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>leaf<span class="dash">-</span>count: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">segtree</span> <span class="tp kw op">:</span> <span class="tp">segtree</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a></span>)

<span class="decl-fun" id="int_add_monoid"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="ck_segtree.html#int_add_monoid">int-add-monoid<span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>int<span class="dash">-</span>add<span class="dash">-</span>monoid: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>()<span class="tp kw op">:</span> <a class="pp" href="#type_space_monoid"><span class="tp">monoid</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>monoid: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <a class="pp" href="#con_space_Monoid"><span class="co">Monoid</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>segtree<span class="fslash last">/</span></span>Monoid: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">one</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">mul</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<span class="number">0</span>, <a class="pp" href="std_core-source.html#_plus__4">(+)<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a></span>)
</pre>

</body>
</html>
