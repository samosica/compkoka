<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="initial-scale=1.0" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Nunito:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>fenwick.kk documentation</title>
</head>

<body class="koka doc body madoko">
<pre class="koka source"><span class="comment">// Fenwick tree
</span><span class="kw">module</span> <a class="pp" href="ck_fenwick.html#_null_"><span class="mo">ck/fenwick</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick</span></span></a>

<span class="kw">import</span> <a class="pp" href="std_num_int64.html#_null_"><span class="mo">std/num/int64</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int64</span></span></a>
<span class="kw">import</span> <a class="pp" href="std_core_undiv.html#_null_"><span class="mo">std/core/undiv</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>undiv</span></span></a>
<span class="kw">import</span> <a class="pp" href="std_core_unsafe.html#_null_"><span class="mo">std/core/unsafe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>unsafe</span></span></a>
<span class="kw">import</span> <a class="pp" href="ck_algebra_monoid.html#_null_"><span class="mo">ck/algebra/monoid</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>algebra<span class="fslash">/</span>monoid</span></span></a>

<span class="decl-value type" id="type_space_fenwick"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Fenwick"><a class="pp" href="ck_fenwick.html#type_space_fenwick"><span class="tp">fenwick</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>fenwick: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <a class="pp" href="ck_fenwick.html#fenwick_fs_tree">tree<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span><span class="lq">fenwick<span class="fslash">/</span></span>tree: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fenwick</span> <span class="tp kw op">:</span> <span class="tp">fenwick</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_ref"><span class="tp">ref</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>ref: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_vector"><span class="tp">vector</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>vector: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span></span></span><span class="tp sp">&gt;</span>

<span class="comment">// Create a Fenwick tree
</span><span class="decl-fun" id="fenwick"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="ck_fenwick.html#fenwick">fenwick<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>fenwick: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">size</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">@implicit<span class="fslash">/</span>monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">fenwick</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">size<span class="pc">size: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>, <a class="pp">@implicit/monoid<span class="pc"><span class="lq">?</span>monoid: <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">145</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="ck_algebra_monoid-source.html#type_space_monoid"><span class="tp">monoid</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>algebra<span class="fslash">/</span>monoid<span class="fslash last">/</span></span>monoid: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span><a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="number">216</span><span class="op">&gt;</span>) fenwick<span class="op">&lt;</span><span class="number">216</span>,<span class="number">215</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_alloc"><span class="tp">alloc</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>alloc: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="#type_space_fenwick"><span class="tp">fenwick</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>fenwick: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <a class="pp" href="#con_space_Fenwick"><span class="co">Fenwick</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>Fenwick: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">tree</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">fenwick</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core_types-source.html#ref">ref<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>ref: <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp op">&lt;$</span><span class="number">145</span><span class="op">&gt;</span>) <span class="kw op">-></span> (alloc<span class="op">&lt;$</span><span class="number">146</span><span class="op">&gt;</span>) ref<span class="op">&lt;$</span><span class="number">146</span>,vector<span class="op">&lt;$</span><span class="number">145</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a>(<a class="pp" href="std_core_vector-source.html#vector">vector<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>vector<span class="fslash last">/</span></span>vector: <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">default</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">145</span>) <span class="kw op">-></span> (alloc<span class="op">&lt;$</span><span class="number">146</span><span class="op">&gt;</span>) vector<span class="op">&lt;$</span><span class="number">145</span><span class="op">&gt;</span></span></a>(<a class="pp">size<span class="pc">size: <span class="tp">int</span></span></a> <a class="pp" href="std_core_int-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp op">&lt;$</span><span class="number">146</span><span class="op">&gt;</span>) int</span></a> <a class="pp">1<span class="pc">literal: <span class="tp">int</span><br>dec  = 1<br>hex8 = 0x01<br>bit8 = 0b00000001</span></a>, <a class="pp">monoid<span class="pc"><span class="lq">?</span>monoid: <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">145</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="ck_algebra_monoid-source.html#monoid_fs_one">one<span class="pc"><span class="mo">ck<span class="fslash">/</span>algebra<span class="fslash">/</span>monoid<span class="fslash last">/</span></span><span class="lq">monoid<span class="fslash">/</span></span>one: <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">145</span><span class="op">&gt;</span>) <span class="kw op">-></span> (alloc<span class="op">&lt;$</span><span class="number">146</span><span class="op">&gt;</span>) <span class="op">$</span><span class="number">145</span></span></a>))</span>)

<span class="decl-fun" id="size"><span class="kw">pub</span> <span class="kw">inline</span> <span class="kw">fun</span> <a class="pp" href="ck_fenwick.html#size">size<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>size: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp">fenwick</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp">int</span></span></a>(<a class="pp">f<span class="pc">f: <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">225</span>,<span class="op">$</span><span class="number">224</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="#type_space_fenwick"><span class="tp">fenwick</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>fenwick: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span><a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="number">283</span><span class="op">&gt;</span><span class="op">&gt;</span> int</span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_total"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>total: <span class="co">E</span></span></a><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>read: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>
  (<a class="pp" href="std_core_types-source.html#ref_fs__excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span><span class="lq">ref<span class="fslash">/</span></span>(!): <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp op">&lt;$</span><span class="number">225</span>,vector<span class="op">&lt;$</span><span class="number">224</span><span class="op">&gt;</span><span class="op">&gt;</span>, @implicit<span class="fslash">/</span>hdiv <span class="tp kw op">:</span> <span class="tp">hdiv</span><span class="tp op">&lt;$</span><span class="number">225</span>,vector<span class="op">&lt;$</span><span class="number">224</span><span class="op">&gt;</span>,div<span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;$</span><span class="number">225</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> vector<span class="op">&lt;$</span><span class="number">224</span><span class="op">&gt;</span><br>?hdiv=iev@250</span></a><a class="pp">f<span class="pc">f: <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">225</span>,<span class="op">$</span><span class="number">224</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#fenwick_fs_tree">tree<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span><span class="lq">fenwick<span class="fslash">/</span></span>tree: <span class="tp sp">(</span><span class="tp tpp">fenwick</span> <span class="tp kw op">:</span> <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">225</span>,<span class="op">$</span><span class="number">224</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;$</span><span class="number">225</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> ref<span class="op">&lt;$</span><span class="number">225</span>,vector<span class="op">&lt;$</span><span class="number">224</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core_vector-source.html#length">length<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>vector<span class="fslash last">/</span></span>length: <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">vector</span><span class="tp op">&lt;$</span><span class="number">224</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;$</span><span class="number">225</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> int</span></a> <a class="pp" href="std_core_int-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">225</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> int</span></a> </span><a class="pp">1<span class="pc">literal: <span class="tp">int</span><br>dec  = 1<br>hex8 = 0x01<br>bit8 = 0b00000001</span></a>

<span class="comment">// Find the rightmost 1 of the binary representation of &#96;x&#96;.
// Return 0 if &#96;x&#96; = 0.
// &#96;x&#96; must be within [-2^63, 2^63 - 1), the range of 64-bit signed integers.
</span><span class="decl-fun" id="rightmost_one"><span class="kw">fun</span> <a class="pp" href="ck_fenwick.html#rightmost_one">rightmost-one<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>rightmost<span class="dash">-</span>one: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a><a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp">int</span></span></a>
  (<a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_int64-source.html#int64">int64<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int64<span class="fslash last">/</span></span>int64: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int64</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_int64-source.html#and">and<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int64<span class="fslash last">/</span></span>and: <span class="tp sp">(</span><span class="tp">int64</span><span class="tp sp">,</span> <span class="tp">int64</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int64</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core_int-source.html#negate">negate<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>negate: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_num_int64-source.html#int64">int64<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int64<span class="fslash last">/</span></span>int64: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int64</span></span></a>))<span class="kw op">.</span><a class="pp" href="std_num_int64-source.html#int">int<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int64<span class="fslash last">/</span></span>int: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int64</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a></span>

<span class="comment">// Add a value to an element.
// The first element is at position 1 (1-based).
// Raise an exception if &#96;index&#96; &lt;= 0 or &#96;index&#96; &gt; &#96;f.size&#96;.
</span><span class="decl-fun" id="add"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="ck_fenwick.html#add">add<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>add: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp">fenwick</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">index</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">@implicit<span class="fslash">/</span>monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">f<span class="pc">f: <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">318</span>,<span class="op">$</span><span class="number">317</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="#type_space_fenwick"><span class="tp">fenwick</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>fenwick: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">index<span class="pc">index: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>, <a class="pp">value<span class="pc">value: <span class="tp op">$</span><span class="number">317</span></span></a><span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>, <a class="pp">@implicit/monoid<span class="pc"><span class="lq">?</span>monoid: <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="ck_algebra_monoid-source.html#type_space_monoid"><span class="tp">monoid</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>algebra<span class="fslash">/</span>monoid<span class="fslash last">/</span></span>monoid: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span><a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="number">574</span><span class="op">&gt;</span>,write<span class="op">&lt;</span><span class="number">574</span><span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_total"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>total: <span class="co">E</span></span></a><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core_exn-source.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>exn<span class="fslash last">/</span></span>exn: <span class="tp sp">(</span><span class="co">E</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>read: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_write"><span class="tp">write</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>write: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <a class="pp" href="std_core_types-source.html#type_space_unit"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unit: <span class="co">V</span></span></a><a class="pp" href="std_core_types-source.html#type_space_unit"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unit: <span class="co">V</span></span></a>
  <span class="kw">val</span> <a class="pp">s<span class="pc">s: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">f<span class="pc">f: <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">318</span>,<span class="op">$</span><span class="number">317</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#size">size<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>size: <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">318</span>,<span class="op">$</span><span class="number">317</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,read<span class="op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,exn,write<span class="op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span><span class="op">&gt;</span> int</span></a>
  <span class="kw">if</span> <a class="pp">index<span class="pc">index: <span class="tp">int</span></span></a> <a class="pp" href="std_core_int-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,write<span class="op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> bool</span></a> <a class="pp">0<span class="pc">literal: <span class="tp">int</span><br>dec  = 0<br>hex8 = 0x00<br>bit8 = 0b00000000</span></a> <a class="pp" href="std_core_types-source.html#_bar__bar_">||<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(||): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,write<span class="op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> bool</span></a> <a class="pp">index<span class="pc">index: <span class="tp">int</span></span></a> <a class="pp" href="std_core_int-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,write<span class="op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> bool</span></a> <a class="pp">s<span class="pc">s: <span class="tp">int</span></span></a> <span class="kw">then</span> <a class="pp">"out of bounds"<span class="pc">literal: <span class="tp">string</span><br>count= 13</span></a><span class="kw op">.</span><a class="pp" href="std_core_exn-source.html#throw">throw<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>exn<span class="fslash last">/</span></span>throw: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">info</span> <span class="tp kw op">:</span> <span class="tp sp">?</span> <span class="tp">exception<span class="dash">-</span>info</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,write<span class="op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> ()</span></a>
  <a class="pp">f<span class="pc">f: <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">318</span>,<span class="op">$</span><span class="number">317</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#fenwick_fs_tree">tree<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span><span class="lq">fenwick<span class="fslash">/</span></span>tree: <span class="tp sp">(</span><span class="tp tpp">fenwick</span> <span class="tp kw op">:</span> <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">318</span>,<span class="op">$</span><span class="number">317</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>exn,read<span class="op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,write<span class="op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> ref<span class="op">&lt;$</span><span class="number">318</span>,vector<span class="op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core_types-source.html#modify">modify<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>modify: <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp op">&lt;$</span><span class="number">318</span>,vector<span class="op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span><span class="op">&gt;</span>, f <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>local<span class="op">&lt;</span>h<span class="op">&gt;</span>,exn,div<span class="op">&gt;</span> (), @implicit<span class="fslash">/</span>hdiv <span class="tp kw op">:</span> <span class="tp">hdiv</span><span class="tp op">&lt;$</span><span class="number">318</span>,vector<span class="op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span>,<span class="op">&lt;</span>exn,div<span class="op">&gt;</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,write<span class="op">&lt;$</span><span class="number">318</span><span class="op">&gt;</span>,exn,div<span class="op">&gt;</span> ()<br>?hdiv=iev@430</span></a> <a class="pp"><span class="kw">fn</span><span class="pc">fn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp">vector</span><span class="tp op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>exn,local<span class="op">&lt;</span>h<span class="op">&gt;</span>,div<span class="op">&gt;</span> ()</span></a>(<a class="pp">t<span class="pc">t: <span class="tp">local<span class="dash">-</span>var</span><span class="tp op">&lt;$</span><span class="number">453</span>,vector<span class="op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a>)
    <span class="decl-fun" id="loop"><span class="kw">fun</span> <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">453</span><span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a><a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">453</span><span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a>
      <span class="kw">if</span> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <a class="pp" href="std_core_int-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">453</span><span class="op">&gt;</span><span class="op">&gt;</span> bool</span></a> <a class="pp">s<span class="pc">s: <span class="tp">int</span></span></a> <span class="kw">then</span>
        <a class="pp">t<span class="pc">t: <span class="tp">local<span class="dash">-</span>var</span><span class="tp op">&lt;$</span><span class="number">453</span>,vector<span class="op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a>[<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>] <span class="kw op">:=</span> (<a class="pp">@implicit/monoid<span class="pc"><span class="lq">?</span>monoid: <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="ck_algebra_monoid-source.html#monoid_fs_mul">mul<span class="pc"><span class="mo">ck<span class="fslash">/</span>algebra<span class="fslash">/</span>monoid<span class="fslash last">/</span></span><span class="lq">monoid<span class="fslash">/</span></span>mul: <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>exn,local<span class="op">&lt;$</span><span class="number">453</span><span class="op">&gt;</span><span class="op">&gt;</span> ((<span class="op">$</span><span class="number">317</span>, <span class="op">$</span><span class="number">317</span>) <span class="kw op">-></span> <span class="op">$</span><span class="number">317</span>)</span></a>)(<a class="pp">t<span class="pc">t: <span class="tp">vector</span><span class="tp op">&lt;$</span><span class="number">317</span><span class="op">&gt;</span><br>?hdiv=iev@507</span></a>[<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>], <a class="pp">value<span class="pc">value: <span class="tp op">$</span><span class="number">317</span></span></a>)
        <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">453</span><span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a>((<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <a class="pp" href="std_core_int-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">453</span><span class="op">&gt;</span><span class="op">&gt;</span> int</span></a> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="#rightmost_one">rightmost-one<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>rightmost<span class="dash">-</span>one: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">453</span><span class="op">&gt;</span><span class="op">&gt;</span> int</span></a>)<span class="kw op">.</span><a class="pp" href="std_core_undiv-source.html#pretend_decreasing">pretend-decreasing<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>undiv<span class="fslash last">/</span></span>pretend<span class="dash">-</span>decreasing: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">453</span><span class="op">&gt;</span><span class="op">&gt;</span> int</span></a></span><a class="pp" href="std_core_types-source.html#con_space_Unit"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>Unit: <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
    <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">local</span><span class="tp op">&lt;$</span><span class="number">453</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> ()</span></a>(<a class="pp">index<span class="pc">index: <span class="tp">int</span></span></a></span>)

<span class="comment">// Return the sum from the first element to the &#96;end&#96;-th element (inclusive).
// The first element is at position 1 (1-based).
// For convenience, return 0 if &#96;end&#96; = 0.
// Raise an exception if &#96;end&#96; &lt; 0 or &#96;end&#96; &gt; &#96;f.size&#96;.
</span><span class="decl-fun" id="prefix_sum"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="ck_fenwick.html#prefix_sum">prefix-sum<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>prefix<span class="dash">-</span>sum: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp">fenwick</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">end</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">@implicit<span class="fslash">/</span>monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<a class="pp">f<span class="pc">f: <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">583</span>,<span class="op">$</span><span class="number">582</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="#type_space_fenwick"><span class="tp">fenwick</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>fenwick: <span class="tp sp">(</span><span class="co">H</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">end<span class="pc">end: <span class="tp">int</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a>, <a class="pp">@implicit/monoid<span class="pc"><span class="lq">?</span>monoid: <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">582</span><span class="op">&gt;</span></span></a><span class="tp kw op">:</span> <a class="pp" href="ck_algebra_monoid-source.html#type_space_monoid"><span class="tp">monoid</span><span class="pc"><span class="mo">ck<span class="fslash">/</span>algebra<span class="fslash">/</span>monoid<span class="fslash last">/</span></span>monoid: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span><a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="number">804</span><span class="op">&gt;</span><span class="op">&gt;</span> <span class="number">803</span></span></a><span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_total"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>total: <span class="co">E</span></span></a><a class="pp" href="std_core_types-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>div: <span class="co">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core_exn-source.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>exn<span class="fslash last">/</span></span>exn: <span class="tp sp">(</span><span class="co">E</span>, <span class="co">V</span>) <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core_types-source.html#type_space_read"><span class="tp">read</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>read: <span class="co">H</span> <span class="kw op">-></span> <span class="co">X</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">h</span><span class="pc">h: <span class="co">H</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>
  <span class="kw">if</span> <a class="pp">end<span class="pc">end: <span class="tp">int</span></span></a> <a class="pp" href="std_core_int-source.html#_lt_">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>(&lt;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span>,exn<span class="op">&gt;</span> bool</span></a> <a class="pp">0<span class="pc">literal: <span class="tp">int</span><br>dec  = 0<br>hex8 = 0x00<br>bit8 = 0b00000000</span></a> <a class="pp" href="std_core_types-source.html#_bar__bar_">||<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>(||): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span>,exn<span class="op">&gt;</span> bool</span></a> <a class="pp">end<span class="pc">end: <span class="tp">int</span></span></a> <a class="pp" href="std_core_int-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span>,exn<span class="op">&gt;</span> bool</span></a> <a class="pp">f<span class="pc">f: <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">583</span>,<span class="op">$</span><span class="number">582</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#size">size<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>size: <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">583</span>,<span class="op">$</span><span class="number">582</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,read<span class="op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span>,exn<span class="op">&gt;</span> int</span></a> <span class="kw">then</span> <a class="pp">"out of bounds"<span class="pc">literal: <span class="tp">string</span><br>count= 13</span></a><span class="kw op">.</span><a class="pp" href="std_core_exn-source.html#throw">throw<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>exn<span class="fslash last">/</span></span>throw: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">info</span> <span class="tp kw op">:</span> <span class="tp sp">?</span> <span class="tp">exception<span class="dash">-</span>info</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span><span class="op">&gt;</span> ()</span></a>
  <span class="decl-fun" id="loop"><span class="kw">fun</span> <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">sum</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">582</span>) <span class="kw op">-></span> <span class="op">&lt;</span>exn,read<span class="op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span><span class="op">&gt;</span> <span class="op">$</span><span class="number">582</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>, <a class="pp">sum<span class="pc">sum: <span class="tp op">$</span><span class="number">582</span></span></a><a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span><span class="op">&gt;</span> <span class="op">$</span><span class="number">582</span></span></a>
    <span class="kw">if</span> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <a class="pp" href="std_core_int-source.html#_gt_">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>(&gt;): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span><span class="op">&gt;</span> bool</span></a> <a class="pp">0<span class="pc">literal: <span class="tp">int</span><br>dec  = 0<br>hex8 = 0x00<br>bit8 = 0b00000000</span></a> <span class="kw">then</span>
      <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">sum</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">582</span>) <span class="kw op">-></span> <span class="op">&lt;</span>exn,read<span class="op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span><span class="op">&gt;</span> <span class="op">$</span><span class="number">582</span></span></a>(
        (<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a> <a class="pp" href="std_core_int-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">y</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span><span class="op">&gt;</span> int</span></a> <a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="#rightmost_one">rightmost-one<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span>rightmost<span class="dash">-</span>one: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span><span class="op">&gt;</span> int</span></a>)<span class="kw op">.</span><a class="pp" href="std_core_undiv-source.html#pretend_decreasing">pretend-decreasing<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>undiv<span class="fslash last">/</span></span>pretend<span class="dash">-</span>decreasing: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span><span class="op">&gt;</span> int</span></a>,
        (<a class="pp">@implicit/monoid<span class="pc"><span class="lq">?</span>monoid: <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">582</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="ck_algebra_monoid-source.html#monoid_fs_mul">mul<span class="pc"><span class="mo">ck<span class="fslash">/</span>algebra<span class="fslash">/</span>monoid<span class="fslash last">/</span></span><span class="lq">monoid<span class="fslash">/</span></span>mul: <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">582</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>exn,read<span class="op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span><span class="op">&gt;</span> ((<span class="op">$</span><span class="number">582</span>, <span class="op">$</span><span class="number">582</span>) <span class="kw op">-></span> <span class="op">$</span><span class="number">582</span>)</span></a>)(<a class="pp">sum<span class="pc">sum: <span class="tp op">$</span><span class="number">582</span></span></a>, (<a class="pp" href="std_core_types-source.html#ref_fs__excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span><span class="lq">ref<span class="fslash">/</span></span>(!): <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp op">&lt;$</span><span class="number">583</span>,vector<span class="op">&lt;$</span><span class="number">582</span><span class="op">&gt;</span><span class="op">&gt;</span>, @implicit<span class="fslash">/</span>hdiv <span class="tp kw op">:</span> <span class="tp">hdiv</span><span class="tp op">&lt;$</span><span class="number">583</span>,vector<span class="op">&lt;$</span><span class="number">582</span><span class="op">&gt;</span>,exn<span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span>,exn<span class="op">&gt;</span> vector<span class="op">&lt;$</span><span class="number">582</span><span class="op">&gt;</span><br>?hdiv=iev@751</span></a><a class="pp">f<span class="pc">f: <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">583</span>,<span class="op">$</span><span class="number">582</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#fenwick_fs_tree">tree<span class="pc"><span class="mo">ck<span class="fslash">/</span>fenwick<span class="fslash last">/</span></span><span class="lq">fenwick<span class="fslash">/</span></span>tree: <span class="tp sp">(</span><span class="tp tpp">fenwick</span> <span class="tp kw op">:</span> <span class="tp">fenwick</span><span class="tp op">&lt;$</span><span class="number">583</span>,<span class="op">$</span><span class="number">582</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>read<span class="op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span>,exn<span class="op">&gt;</span> ref<span class="op">&lt;$</span><span class="number">583</span>,vector<span class="op">&lt;$</span><span class="number">582</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a>)[<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>])
      )
    <span class="kw">else</span>
      <a class="pp">sum<span class="pc">sum: <span class="tp op">$</span><span class="number">582</span></span></a></span>
  <a class="pp">loop<span class="pc">loop: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">sum</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">582</span>) <span class="kw op">-></span> <span class="op">&lt;</span>exn,read<span class="op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> <span class="op">$</span><span class="number">582</span></span></a>(<a class="pp">end<span class="pc">end: <span class="tp">int</span></span></a>, <a class="pp">@implicit/monoid<span class="pc"><span class="lq">?</span>monoid: <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">582</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="ck_algebra_monoid-source.html#monoid_fs_one">one<span class="pc"><span class="mo">ck<span class="fslash">/</span>algebra<span class="fslash">/</span>monoid<span class="fslash last">/</span></span><span class="lq">monoid<span class="fslash">/</span></span>one: <span class="tp sp">(</span><span class="tp tpp">monoid</span> <span class="tp kw op">:</span> <span class="tp">monoid</span><span class="tp op">&lt;$</span><span class="number">582</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>exn,read<span class="op">&lt;$</span><span class="number">583</span><span class="op">&gt;</span>,div<span class="op">&gt;</span> <span class="op">$</span><span class="number">582</span></span></a></span>)
</pre>

</body>
</html>
